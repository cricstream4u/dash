<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TG- @cric_stream</title>
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
    <style>
        .video-container {
            position: relative;
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            margin-top: 5px;
            text-align: center;
        }

        video {
            width: 100%;
            height: auto;
        }

        /* Buffering spinner styles */
        .buffering-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ffffff;
            animation: spin 1s linear infinite;
            display: none;
        }

        @keyframes spin {
            from {
                transform: translate(-50%, -50%) rotate(0deg);
            }
            to {
                transform: translate(-50%, -50%) rotate(360deg);
            }
        }

        @media (orientation: landscape) and (fullscreen) {
            video {
                width: 100vw;
                height: 100vh;
                object-fit: contain;
            }
        }
    </style>
</head>
<body>
    <div>
        <div style="display: flex; align-items: center; gap: 0px; width: 100%; background-color: #006400;">
            <h4 style="flex-shrink: 0; margin: 0; font-size: 20px; color: #fff; background-color: #006400;">UPDATES:</h4>
            <div style="overflow: hidden; white-space: nowrap; flex-grow: 1; box-sizing: border-box;">
                <p style="display: inline-block; margin: 0; font-size: 18px; color: white; background-color: #dc143c; animation: marquee 50s linear infinite;">
                    The Video May Take 30 Seconds To Play. After That, There Will Be No Buffering. If Any Issue, Inform us on Telegram. वीडियो को चलने में 30 सेकंड का समय लग सकता है, उसके बाद कोई बफ़रिंग नहीं होगी अधिक जानने के लिए टेलीग्राम पर हमसे जुड़ें।
                </p>
            </div>
        </div>
        <style>
            @keyframes marquee { 
                from { transform: translateX(0%); }
                to { transform: translateX(-100%); }
            }
        </style>
    </div>
    
    <div class="video-container">
        <div class="buffering-spinner" id="buffering-spinner"></div>
        <video id="video-player" controls crossorigin playsinline poster="CRIC stream Thumbnail .jpg"></video>
    </div>
    
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const urlParams = new URLSearchParams(window.location.search);
            const videoUrl = urlParams.get('video');

            if (!videoUrl) {
                document.body.innerHTML = "<h2>Video URL missing in query parameter</h2>";
                return;
            }

            const videoElement = document.getElementById('video-player');
            const bufferingSpinner = document.getElementById('buffering-spinner');

            // Show spinner during buffering
            const showSpinner = () => bufferingSpinner.style.display = "block";
            const hideSpinner = () => bufferingSpinner.style.display = "none";

            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(videoUrl);
                hls.attachMedia(videoElement);

                const player = new Plyr(videoElement, {
                    controls: [
                        'play-large',
                        'play',
                        'progress',
                        'current-time',
                        'mute',
                        'volume',
                        'settings',
                        'pip',
                        'fullscreen',
                    ],
                    settings: ['quality'],
                });

                hls.on(Hls.Events.MANIFEST_PARSED, () => {
                    const availableQualities = hls.levels.map(level => level.height);
                    player.config.quality = {
                        default: 0,
                        options: [0, ...availableQualities],
                        forced: true,
                        onChange: (newQuality) => updateQuality(hls, newQuality),
                    };
                });

                // Listen to buffering events
                hls.on(Hls.Events.BUFFER_APPENDING, showSpinner);
                hls.on(Hls.Events.BUFFER_APPENDED, hideSpinner);
                hls.on(Hls.Events.ERROR, (event, data) => {
                    if (data.fatal) {
                        console.error('Fatal error encountered:', data);
                        alert('An error occurred while playing the video.');
                        hideSpinner();
                    }
                });

            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                videoElement.src = videoUrl;
                const player = new Plyr(videoElement, {
                    controls: [
                        'play-large',
                        'play',
                        'progress',
                        'current-time',
                        'mute',
                        'volume',
                        'settings',
                        'pip',
                        'fullscreen',
                    ],
                    settings: ['quality'],
                });

                videoElement.addEventListener('waiting', showSpinner);
                videoElement.addEventListener('playing', hideSpinner);
                videoElement.addEventListener('canplay', hideSpinner);
                videoElement.addEventListener('canplaythrough', hideSpinner);
            } else {
                alert('Your browser does not support HLS playback.');
            }
        });

        function updateQuality(hls, newQuality) {
            if (newQuality === 0) {
                hls.currentLevel = -1;
            } else {
                hls.levels.forEach((level, index) => {
                    if (level.height === newQuality) {
                        hls.currentLevel = index;
                    }
                });
            }
        }

        // Enforce landscape mode in fullscreen
        const videoElement = document.getElementById('video-player');
        videoElement.addEventListener('fullscreenchange', () => {
            if (document.fullscreenElement) {
                if (screen.orientation.lock) {
                    screen.orientation.lock('landscape').catch((err) => console.warn('Orientation lock failed:', err));
                }
            } else {
                if (screen.orientation.unlock) {
                    screen.orientation.unlock();
                }
            }
        });

        if (confirm("Join Our Telegram Channel @cric_stream For More Links")) {
            window.location.href = "https://t.me/cric_stream";
        }
    </script>
</body>
</html>
