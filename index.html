<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TG- @cric_stream</title>
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
    <style>
        .video-container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            text-align: center;
        }

        video {
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <div>
        <div style="display: flex; align-items: center; gap: 0px; width: 100%; background-color: #006400;">
<!-- Fixed H4 -->
<h4 style="flex-shrink: 0; margin: 0; font-size: 20px; color: #fff; background-color: #006400;">UPDATES:</h4>
<!-- Scrolling P (Marquee) -->
<div style="overflow: hidden; white-space: nowrap; flex-grow: 1; box-sizing: border-box;">
<p style="display: inline-block; margin: 0; font-size: 18px; color: white; background-color: #dc143c; animation: marquee 50s linear infinite;">The Video May Take 30 Seconds To Play. After That, There Will Be No Buffering. If Any Issue, Inform us on Telegram. वीडियो को चलने में 30 सेकंड का समय लग सकता है, उसके बाद कोई बफ़रिंग नहीं होगी अधिक जानने के लिए टेलीग्राम पर हमसे जुड़ें।</p>

</div>
</div>
<style>
    @keyframes marquee{ 
        from { transform: translateX(0%); }
        to { transform: translateX(-100%); }
    }
</style>
    </div>
    <div class="video-container">
        <video id="video-player" controls crossorigin playsinline></video>
    </div>
    <br>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const urlParams = new URLSearchParams(window.location.search);
            const videoUrl = urlParams.get('video');

            if (!videoUrl) {
                document.body.innerHTML = "<h2>Video URL missing in query parameter</h2>";
                return;
            }

            const videoElement = document.getElementById('video-player');

            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(videoUrl);
                hls.attachMedia(videoElement);

                // Initialize Plyr with default settings
                const player = new Plyr(videoElement, {
                    controls: [
                        'play-large',
                        'play',
                        'progress',
                        'current-time',
                        'mute',
                        'volume',
                        'settings',
                        'fullscreen',
                    ],
                    settings: ['quality'],
                });

                // Capture quality levels when the manifest is parsed
                hls.on(Hls.Events.MANIFEST_PARSED, () => {
                    const availableQualities = hls.levels.map(level => level.height);
                    console.log('Available qualities:', availableQualities);

                    // Add quality options to Plyr
                    player.config.quality = {
                        default: 0, // Default to auto
                        options: [0, ...availableQualities], // Include 'auto' (0) and all available quality levels
                        forced: true,
                        onChange: (newQuality) => {
                            updateQuality(hls, newQuality);
                        },
                    };

                    player.settingsMenu = ['quality']; // Ensure 'quality' shows in settings
                });

                hls.on(Hls.Events.ERROR, (event, data) => {
                    if (data.fatal) {
                        console.error('Fatal error encountered:', data);
                        alert('An error occurred while playing the video.');
                    }
                });

                // Detect quality changes dynamically
                hls.on(Hls.Events.LEVEL_SWITCHED, (event, data) => {
                    const currentQuality = hls.levels[data.level].height;
                    console.log('Switched to quality:', currentQuality);
                });
            } else if (videoElement.canPlayType('application/vnd.apple.mpegurl')) {
                // For Safari and other native HLS-supporting browsers
                videoElement.src = videoUrl;
                const player = new Plyr(videoElement, {
                    controls: [
                        'play-large',
                        'play',
                        'progress',
                        'current-time',
                        'mute',
                        'volume',
                        'settings',
                        'fullscreen',
                    ],
                    settings: ['quality'],
                });
            } else {
                alert('Your browser does not support HLS playback.');
            }
        });

        // Function to update HLS quality
        function updateQuality(hls, newQuality) {
            if (newQuality === 0) {
                hls.currentLevel = -1; // Auto quality
            } else {
                hls.levels.forEach((level, index) => {
                    if (level.height === newQuality) {
                        hls.currentLevel = index;
                    }
                });
            }
        }
    </script>
     <!-- Powered by Supercounters -->
    <center>
        <script type="text/javascript" src="//widget.supercounters.com/ssl/online_t.js"></script>
        <script type="text/javascript">sc_online_t(1703448, "Watching....", "#1d1d21");</script>
        <br>
        <noscript><a href="https://www.supercounters.com/"></a></noscript>
    </center>
    <!-- END: Powered by Supercounters -->

    <div style="background-color: #0074d9; text-align: center; padding: 10px;">
        <a href="https://telegram.me/cric_stream" target="_blank">
            <button id="joinTelegramButton">Join Telegram</button>
        </a>
    </div>
    <div>
        <br>
        <br>
        <script async="async" data-cfasync="false" src="//carryglanced.com/2346ffc02acfb9eb4451708a5df9f609/invoke.js"></script>
        <div id="container-2346ffc02acfb9eb4451708a5df9f609"></div>
    </div>
</body>
</html>
